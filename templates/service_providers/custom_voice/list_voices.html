{% extends "web/app/app_base.html" %}
{% load i18n %}

{% block app %}
<div class="prose max-w-none">
  <div class="flex justify-between items-center mb-4">
    <h1 class="mb-0">{% translate "Custom Voices" %}</h1>
    <div class="flex gap-2">
      <a href="{% url 'service_providers:custom_voice_create_consent' request.team.slug provider.pk %}"
         class="btn btn-secondary btn-sm">
        <i class="fa-solid fa-plus mr-1"></i> {% translate "New Consent" %}
      </a>
      <a href="{% url 'service_providers:custom_voice_create' request.team.slug provider.pk %}"
         class="btn btn-primary btn-sm">
        <i class="fa-solid fa-plus mr-1"></i> {% translate "Create Voice" %}
      </a>
    </div>
  </div>

  <p class="text-sm opacity-70">
    {% translate "Provider:" %} {{ provider.name }}
  </p>

  {% if error_message %}
    <div class="alert alert-warning mb-4">
      <i class="fa-solid fa-exclamation-triangle mr-2"></i>
      {% translate "Could not connect to OpenAI:" %} {{ error_message }}
    </div>
  {% endif %}

  {% if voices %}
    <div class="overflow-x-auto">
      <table class="table table-zebra w-full">
        <thead>
          <tr>
            <th>{% translate "Name" %}</th>
            <th>{% translate "Voice ID" %}</th>
            <th>{% translate "Created" %}</th>
            <th>{% translate "Status" %}</th>
            <th>{% translate "Actions" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for voice in voices %}
            <tr>
              <td>{{ voice.name }}</td>
              <td><code class="text-xs">{{ voice.get_openai_voice_id|default:"N/A" }}</code></td>
              <td>{{ voice.created_at|date:"Y-m-d H:i" }}</td>
              <td>
                {% if voice.get_openai_voice_id in openai_voices %}
                  <span class="badge badge-success">{% translate "Active" %}</span>
                {% else %}
                  <span class="badge badge-warning">{% translate "Not in OpenAI" %}</span>
                {% endif %}
              </td>
              <td>
                <form method="post"
                      action="{% url 'service_providers:custom_voice_delete' request.team.slug provider.pk voice.pk %}"
                      onsubmit="return confirm('{% translate "Are you sure you want to delete this voice?" %}');">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-error btn-xs">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-info">
      <i class="fa-solid fa-info-circle mr-2"></i>
      <div>
        <p>{% translate "No custom voices created yet." %}</p>
        <p class="text-sm mt-2">
          {% translate "To create a voice, you first need to upload a consent recording, then create the voice with an audio sample." %}
        </p>
      </div>
    </div>
  {% endif %}

  {% if consents %}
    <h2 class="mt-8">{% translate "Available Consents" %}</h2>
    <div class="overflow-x-auto">
      <table class="table table-zebra w-full">
        <thead>
          <tr>
            <th>{% translate "Name" %}</th>
            <th>{% translate "Consent ID" %}</th>
            <th>{% translate "Language" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for consent in consents %}
            <tr>
              <td>{{ consent.name }}</td>
              <td><code class="text-xs">{{ consent.id }}</code></td>
              <td>{{ consent.language }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% endif %}

  <div class="mt-8">
    <a href="{% url 'single_team:manage_team' request.team.slug %}" class="btn btn-ghost btn-sm">
      <i class="fa-solid fa-arrow-left mr-1"></i> {% translate "Back to Team Settings" %}
    </a>
  </div>
</div>
{% endblock app %}
