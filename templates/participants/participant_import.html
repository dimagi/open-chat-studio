{% extends "web/app/app_base.html" %}
{% load form_tags %}
{% load static %}

{% block app %}
  <div class="app-card">
    <h1 class="pg-title">Import Participants</h1>
    <div class="mb-4">
      <h3>CSV Format</h3>
      <p>Your CSV file should have the following columns:</p>
      <ul>
        <li><strong>identifier</strong> (required) - Unique identifier for the participant (e.g., email address)</li>
        <li><strong>platform</strong> (required) - Platform type (web, telegram, whatsapp, etc.)</li>
        <li><strong>name</strong> (optional) - Display name for the participant</li>
        <li><strong>data.*</strong> (optional) - Custom data fields (e.g., data.age, data.preferences)</li>
      </ul>
      <p><strong>Example:</strong></p>
      <pre>identifier,platform,name,data.age,data.location
user@example.com,web,John Doe,25,New York
+1234567890,whatsapp,Jane Smith,30,"{""city"":""London"",""country"":""UK""}"</pre>
    </div>
    <div>
      <form method="post" enctype="multipart/form-data" class="my-2">
        {% csrf_token %}
        {{ form.non_field_errors }}
        {% render_form_fields form %}
        <input type="submit" class="btn btn-primary mt-2" value="Import">
      </form>
    </div>

    {% if import_results %}
      {% if import_results.created or import_records.updated %}
        <div class="mt-6">
          <p class="text-md font-semibold text-success mb-2">Successfully created {{ import_results.created }} records
            and updated {{ import_results.updated }} records.</p>
        </div>
      {% endif %}
      {% if import_results.errors %}
        <div class="mt-6">
          <h3 class="text-lg font-semibold text-error mb-2">Import Errors ({{ import_results.errors|length }})</h3>
          <p class="text-sm text-base-content/70 my-2">
            Please fix the errors above and try importing again.
          </p>
          <div class="bg-error/10 border border-error/20 rounded-lg p-4 max-h-96 overflow-y-auto">
            <ul class="space-y-1">
              {% for error in import_results.errors %}
                <li class="text-md">{{ error }}</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      {% endif %}
    {% endif %}
  </div>
{% endblock app %}}
