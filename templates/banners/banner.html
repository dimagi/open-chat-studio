<div class="banners-container"
     hx-get="{% url 'banners:load_banners' %}"
     hx-trigger="load"
     hx-swap="innerHTML">
</div>
<script>
    function updateDismissedBanners(bannerId, bannerExpiry) {
        try {
            let cookieName = `dismissed_banner_${bannerId}`;
            const dismissed = SiteJS.app.Cookies.get(cookieName);
            if (!dismissed) {
                SiteJS.app.Cookies.set(cookieName, 1, { expires: Number(bannerExpiry) });
            }
        } catch (error) {
            if (error instanceof TypeError) {
                console.error('TypeError in updateDismissedBanners:', error.message);
            } else {
                throw error;
            }
        }
    }

    function attachBannerDismissHandlers(container) {
        container.querySelectorAll('.dismiss-banner').forEach(button => {
            button.addEventListener('click', function() {
                const alert = this.closest('.alert');
                const bannerId = this.dataset.bannerId;
                if (alert && bannerId) {
                    const bannerExpiry = this.dataset.expiry;
                    updateDismissedBanners(bannerId, bannerExpiry);
                    alert.remove();
                }
            });
        });
    }

    // Attach handlers after HTMX loads the content
    document.addEventListener('htmx:afterSwap', function(event) {
        if (event.target.classList.contains('banners-container')) {
            attachBannerDismissHandlers(event.target);
        }
    });
</script>
