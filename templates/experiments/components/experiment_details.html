{% load i18n waffle_tags %}

<div>
  <div class="pl-4">
    <dl class="divide-y divide-gray-100">
      {% for label, chip in details %}
        <div class="py-3 grid grid-cols-3 sm:gap-4">
          <dt class="text-sm font-medium leading-6">{{ label }}</dt>
          <dd class="text-sm col-span-2">
            {% include "generic/chip.html" %}
          </dd>
        </div>
      {% endfor %}
      <div class="py-3 grid grid-cols-3 sm:gap-4">
        <dt class="text-sm font-medium leading-6">{% translate "Platform" %}</dt>
        <dd class="text-sm col-span-2">
          {{ experiment_session.get_platform_name }}
          {% if experiment_session.chat.embed_source %}
            (Embedded at <a class="link" href="{{ experiment_session.chat.embed_source }}" target="_blank">
              {{ experiment_session.chat.embed_source }}
            </a>)
          {% endif %}
        </dd>
      </div>
      {% if experiment_session.chat.metadata.openai_thread_id %}
        <div class="py-3 grid grid-cols-3 sm:gap-4">
          <dt class="text-sm font-medium leading-6">OpenAI Thread</dt>
          <dd class="text-sm col-span-2">
            {% include "generic/copy_chip.html" with copy_element_id="thread_id" copy_value=experiment_session.chat.metadata.openai_thread_id %}
          </dd>
        </div>
      {% endif %}
      <div class="py-3 grid grid-cols-3">
        <dt class="text-sm font-medium leading-6">Tags</dt>
        <dd class="col-span-2 mr-2">
          {% include "annotations/tag_ui.html" with object=experiment_session.chat allow_edit=experiment.is_editable %}
        </dd>
      </div>
      {% if perms.human_annotations.add_annotationitem %}
        <div class="py-3 grid grid-cols-3 sm:gap-4">
          <dt class="text-sm font-medium leading-6">{% translate "Annotation Queues" %}</dt>
          <dd class="text-sm col-span-2">
            <button class="btn btn-sm btn-ghost"
                    hx-get="{% url 'human_annotations:session_add_to_queue' request.team.slug experiment_session.external_id %}"
                    hx-target="#add-to-queue-modal-container-{{ experiment_session.pk }}"
                    hx-swap="innerHTML"
                    hx-on::after-settle="document.getElementById('add-to-queue-dialog-{{ experiment_session.pk }}').showModal()">
              <i class="fa-solid fa-plus"></i> {% translate "Add to Queue" %}
            </button>
            <div id="add-to-queue-modal-container-{{ experiment_session.pk }}"></div>
          </dd>
        </div>
      {% endif %}
      {% if perms.annotations.add_usercomment %}
        <div x-data="{showComments: false}">
          <div class="py-3 grid grid-cols-3 mb-2">
            <dt class="text-sm font-medium leading-6">
              Comments (<span id="{{ experiment_session.chat.comment_count_element_id }}">{{ experiment_session.chat.get_user_comments|length }}</span>)
            </dt>
            <dd class="col-span-2 mr-2 text-gray-500">
              <button class="btn btn-sm" @click="showComments = !showComments;">
                <div x-show="!showComments">View comments</div>
                <div x-show="showComments" x-cloak>Hide comments</div>
              </button>
            </dd>
          </div>
          <div class="col-span-3 mr-2" x-cloak x-show="showComments">
            {% include "experiments/components/user_comments.html" with object=experiment_session.chat allow_edit=experiment.is_editable %}
          </div>
        </div>
      {% endif %}
    </dl>
  </div>
</div>
