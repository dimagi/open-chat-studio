{% load i18n %}
{% if audit_events %}
  <div class="overflow-hidden shadow ring-1 ring-black ring-opacity-5 rounded-lg">
    <table class="min-w-full divide-y divide-gray-300">
      <thead class="bg-gray-50">
        <tr>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wide">
            {% translate "Date" %}
          </th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wide">
            {% translate "User" %}
          </th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wide">
            {% translate "Changes" %}
          </th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        {% for event in audit_events %}
          <tr>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              {{ event.event_date|date:"M j, Y g:i A" }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              {{ event.change_context.username|default:"System" }}
            </td>
            <td class="px-6 py-4 text-sm text-gray-900">
              {% if event.is_create %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  {% translate "Created" %}
                </span>
              {% elif event.is_delete %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                  {% translate "Deleted" %}
                </span>
              {% else %}
                <div class="space-y-1">
                  {% for field_name, field_data in event.delta.items %}
                    <div class="text-xs">
                      <span class="font-medium">{{ field_name|capfirst }}:</span>
                      {% if field_data.old != field_data.new %}
                        <span class="text-red-600">{{ field_data.old|default_if_none:"None" }}</span>
                        â†’
                        <span class="text-green-600">{{ field_data.new|default_if_none:"None" }}</span>
                      {% endif %}
                    </div>
                  {% endfor %}
                </div>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if audit_events|length >= 50 %}
    <p class="mt-3 text-sm text-gray-500">
      {% translate "Showing last 50 changes." %}
    </p>
  {% endif %}
{% else %}
  <div class="text-center py-8 text-gray-500">
    <p>{% translate "No changes recorded yet." %}</p>
  </div>
{% endif %}