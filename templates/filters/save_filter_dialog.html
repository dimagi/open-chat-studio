{% load i18n %}
{% with df_table_type=df_table_type %}
<dialog id="saveFilterDialog" class="modal">
  <div class="modal-box max-w-md bg-base-100 border border-base-300">
    <div class="flex items-center justify-between mb-6">
      <h3 class="font-bold text-lg text-base-content">{% trans "Create Filter Set" %}</h3>
      <form method="dialog">
        <button class="btn btn-sm btn-ghost text-base-content hover:bg-base-200">âœ•</button>
      </form>
    </div>

    <!-- Create New Filter Set Form -->
    <form id="createFilterSetForm" 
          hx-post="{% url 'filters:create_filter_set' request.team.slug df_table_type %}"
          hx-indicator="#saveFilterBtn"
          hx-swap="none"
          hx-on:htmx:after-request="afterRequest(event);">
      {% csrf_token %}
      <input type="hidden" name="filter_query_string" value="{{ request.GET.urlencode }}" />
      <div class="mb-6">
        <label class="block text-sm font-medium text-base-content mb-2">{% trans "Name" %}</label>
        <input
          type="text" 
          name="name"
          id="filterSetName" 
          class="input input-bordered w-full bg-base-100 border-base-300 text-base-content placeholder-base-content/60 focus:border-primary" 
          placeholder='{% trans "Name" %}'
          required>
      </div>
      
      <div class="flex justify-end gap-3">
        <form method="dialog">
          <button
            type="button"
            onclick="saveFilterDialog.close()"
            class="btn btn-ghost text-base-content hover:bg-base-200">
            {% trans "Cancel" %}
          </button>
        </form>
        <button type="submit" class="btn btn-primary" id="saveFilterBtn">
          <span id="saveFilterText">{% trans "Save" %}</span>
        </button>
      </div>
    </form>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>
<script>
  function afterRequest(event) {
    if(event.detail.successful) {
      alertify.notify(`Filter saved!`, 'success', 10);
    } else {
      alertify.notify('Failed to save filter', 'error', 10);
    }

    saveFilterDialog.close();
    savedFiltersDialog.close();
  }
</script>
{% endwith %}