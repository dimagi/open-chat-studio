{% load json_tags %}

<div 
    x-show="$store.spanDrawer.isOpen && $store.spanDrawer.spanId === '{{ span.id }}'" 
    x-transition:enter="transition ease-out duration-300 transform"
    x-transition:enter-start="translate-x-full"
    x-transition:enter-end="translate-x-0"
    x-transition:leave="transition ease-in duration-200 transform"
    x-transition:leave-start="translate-x-0"
    x-transition:leave-end="translate-x-full"
    class="fixed top-0 right-0 z-50 w-full max-w-2xl h-full bg-base-100 shadow-xl overflow-y-auto border border-l border-base-300"
    x-cloak>
    <!-- Header -->
    <div class="flex items-center justify-between p-6 border-b border-base-300">
        <div>
            <h2 class="text-xl font-bold">{{ span.name }}</h2>
            <p class="text-sm text-base-content/60">Span Details</p>
        </div>
        <button 
            @click="$store.spanDrawer.close()"
            class="btn btn-ghost btn-sm btn-circle">
            <i class="fa-solid fa-times"></i>
        </button>
    </div>

    <!-- Content -->
    <div class="p-6">
        <div class="mb-6">
            <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                    <span class="font-semibold">Status:</span>
                    <span class="ml-2 {% if span.status == 'error' %}text-red-500{% elif span.status == 'success' %}text-green-500{% endif %}">
                        {{ span.status|title }}
                    </span>
                </div>
                <div>
                    <span class="font-semibold">Duration:</span>
                    <span class="ml-2">{{ span.duration_seconds }}s</span>
                </div>
                {% if span.start_time %}
                <div>
                    <span class="font-semibold">Started:</span>
                    <span class="ml-2">{{ span.start_time|date:"y-m-d H:i:s.u" }}</span>
                </div>
                {% endif %}
                {% if span.end_time %}
                <div>
                    <span class="font-semibold">Ended:</span>
                    <span class="ml-2">{{ span.end_time|date:"y-m-d H:i:s.u" }}</span>
                </div>
                {% endif %}
            </div>
        </div>

        {% if span.prefetched_tagged_items %}
        <div class="mb-6">
            <h3 class="text-lg font-semibold mb-3">Tags</h3>
            <div class="flex flex-wrap gap-2">
                {% for tag in span.prefetched_tagged_items %}
                    <span class="badge badge-info">{{ tag.name }}</span>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div x-data="{ activeTab: 'input' }" class="w-full">
            <div class="tabs tabs-boxed mb-4">
                <button 
                    @click="activeTab = 'input'" 
                    :class="activeTab === 'input' ? 'tab-active' : ''"
                    class="tab">
                    Input
                </button>
                <button 
                    @click="activeTab = 'output'" 
                    :class="activeTab === 'output' ? 'tab-active' : ''"
                    class="tab">
                    Output
                </button>
                <button 
                    @click="activeTab = 'metadata'" 
                    :class="activeTab === 'metadata' ? 'tab-active' : ''"
                    class="tab">
                    Metadata
                </button>
            </div>

            <div class="min-h-96">
                <!-- Input Tab -->
                <div x-show="activeTab === 'input'">
                    <h3 class="text-lg font-semibold mb-3">Input Data</h3>
                    {% if span.input %}
                        <div class="bg-base-300 p-4 rounded-lg border">
                            <pre class="text-sm overflow-x-auto whitespace-pre-wrap"><code>{{ span.input|to_json }}</code></pre>
                        </div>
                    {% else %}
                        <div class="text-center text-base-content/60 py-8">
                            <p>No input data available for this span.</p>
                        </div>
                    {% endif %}

                    {% if span.error %}
                        <div class="mt-6">
                            <h4 class="text-lg font-semibold text-red-600 mb-3">Error</h4>
                            <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                                <pre class="text-sm overflow-x-auto whitespace-pre-wrap text-red-800"><code>{{ span.error }}</code></pre>
                            </div>
                        </div>
                    {% endif %}
                </div>

                <!-- Output Tab -->
                <div x-show="activeTab === 'output'">
                    <h3 class="text-lg font-semibold mb-3">Output Data</h3>
                    {% if span.output %}
                        <div class="bg-base-300 p-4 rounded-lg border">
                            <pre class="text-sm overflow-x-auto whitespace-pre-wrap"><code>{{ span.output|to_json }}</code></pre>
                        </div>
                    {% else %}
                        <div class="text-center text-base-content/60 py-8">
                            <p>No output data available for this span.</p>
                        </div>
                    {% endif %}
                </div>

                <!-- Metadata Tab -->
                <div x-show="activeTab === 'metadata'">
                    <h3 class="text-lg font-semibold mb-3">Metadata</h3>
                    {% if span.metadata %}
                        <div class="bg-base-300 p-4 rounded-lg border">
                            <pre class="text-sm overflow-x-auto whitespace-pre-wrap"><code>{{ span.metadata|to_json }}</code></pre>
                        </div>
                    {% else %}
                        <div class="text-center text-base-content/60 py-8">
                            <p>No metadata available for this span.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>